# gradient_merge_precision_alignment

## before add gradient_merge

batch_size 128

steps 12

sh run.sh

```
0   [0.29568613]
------------>[[ 0.00325679 -0.00487973  0.01728465 ...  0.00671757 -0.00927767
   0.00032223]
 [ 0.01504303 -0.02287037  0.04029361 ... -0.01235466  0.00298695
  -0.02744791]
 [-0.02089648  0.0078622   0.02504907 ...  0.02143094 -0.0081911
  -0.0083656 ]
 ...
 [ 0.01109418 -0.00380935  0.01080439 ... -0.0198461  -0.03210769
  -0.00653965]
 [-0.05513816  0.01758596 -0.0000703  ... -0.01524768  0.0313245
   0.00963614]
 [-0.00963047  0.01430357  0.01931395 ... -0.00035427 -0.00872168
   0.05857831]]
1   [0.36115643]
------------>[[ 0.00325783 -0.00487893  0.01728542 ...  0.00671828 -0.00927696
   0.00032267]
 [ 0.01503996 -0.02287298  0.04029076 ... -0.01235752  0.00298396
  -0.0274507 ]
 [-0.02089628  0.00786247  0.0250492  ...  0.02143151 -0.00819083
  -0.0083651 ]
 ...
 [ 0.01109258 -0.00381054  0.01080323 ... -0.01984735 -0.03210912
  -0.00654107]
 [-0.05513571  0.01758823 -0.00006782 ... -0.01524513  0.03132679
   0.00963861]
 [-0.0096294   0.01430442  0.0193147  ... -0.00035345 -0.00872087
   0.05857904]]
2   [0.3366242]
------------>[[ 0.00326039 -0.00487684  0.01728758 ...  0.00672072 -0.00927485
   0.00032486]
 [ 0.01503776 -0.02287492  0.04028855 ... -0.01235968  0.00298198
  -0.02745253]
 [-0.02089414  0.00786436  0.02505121 ...  0.02143367 -0.0081888
  -0.00836281]
 ...
 [ 0.01109286 -0.00380986  0.01080392 ... -0.01984675 -0.03210872
  -0.00654065]
 [-0.05513266  0.01759095 -0.00006477 ... -0.01524187  0.03132967
   0.00964181]
 [-0.00962864  0.01430498  0.01931518 ... -0.00035297 -0.00872017
   0.05857989]]
3   [0.30737257]
------------>[[ 0.00326109 -0.00487633  0.01728828 ...  0.00672141 -0.00927429
   0.00032537]
 [ 0.01503677 -0.02287557  0.04028765 ... -0.01236058  0.00298096
  -0.02745331]
 [-0.02089231  0.00786604  0.02505258 ...  0.0214355  -0.00818702
  -0.00836079]
 ...
 [ 0.01109193 -0.00381047  0.01080328 ... -0.01984772 -0.0321096
  -0.00654166]
 [-0.0551292   0.01759418 -0.0000615  ... -0.01523818  0.031333
   0.00964531]
 [-0.00962826  0.01430529  0.0193154  ... -0.00035272 -0.00871991
   0.05858026]]
4   [0.34085673]
------------>[[ 0.00326397 -0.0048739   0.01729077 ...  0.00672391 -0.00927189
   0.00032767]
 [ 0.01503458 -0.02287736  0.04028547 ... -0.01236274  0.00297887
  -0.02745526]
 [-0.02089187  0.00786638  0.02505288 ...  0.02143609 -0.00818656
  -0.00836013]
 ...
 [ 0.01109042 -0.00381133  0.01080217 ... -0.01984893 -0.03211083
  -0.00654307]
 [-0.05512483  0.01759816 -0.00005747 ... -0.01523391  0.03133708
   0.0096495 ]
 [-0.00962767  0.01430586  0.01931574 ... -0.00035235 -0.00871944
   0.05858071]]
5   [0.3735875]
------------>[[ 0.00326639 -0.00487175  0.01729292 ...  0.00672599 -0.00926979
   0.00032957]
 [ 0.01503262 -0.02287916  0.04028361 ... -0.01236481  0.00297709
  -0.02745693]
 [-0.02088915  0.00786918  0.02505555 ...  0.0214393  -0.00818381
  -0.00835684]
 ...
 [ 0.01108954 -0.0038119   0.01080148 ... -0.01984955 -0.03211144
  -0.00654371]
 [-0.05512026  0.01760272 -0.00005291 ... -0.01522891  0.03134158
   0.00965404]
 [-0.00962573  0.01430745  0.01931728 ... -0.0003507  -0.00871765
   0.05858242]]
6   [0.33240762]
------------>[[ 0.00326861 -0.00486996  0.01729468 ...  0.00672766 -0.00926806
   0.00033101]
 [ 0.01503042 -0.02288103  0.04028141 ... -0.01236691  0.00297496
  -0.02745906]
 [-0.02088803  0.00787029  0.02505665 ...  0.02144069 -0.00818253
  -0.00835523]
 ...
 [ 0.01108734 -0.00381362  0.01079982 ... -0.01985138 -0.0321133
  -0.0065456 ]
 [-0.05511615  0.01760673 -0.00004862 ... -0.01522456  0.03134567
   0.00965827]
 [-0.00962398  0.01430881  0.01931856 ... -0.00034933 -0.00871615
   0.05858382]]
7   [0.2895818]
------------>[[ 0.00327092 -0.00486813  0.01729666 ...  0.00672956 -0.00926611
   0.00033294]
 [ 0.01502885 -0.02288222  0.04027987 ... -0.01236843  0.00297352
  -0.02746046]
 [-0.0208852   0.00787294  0.02505932 ...  0.0214438  -0.00817975
  -0.00835223]
 ...
 [ 0.01108522 -0.00381511  0.01079822 ... -0.019853   -0.03211506
  -0.00654736]
 [-0.0551131   0.0176094  -0.00004582 ... -0.01522143  0.03134868
   0.00966137]
 [-0.0096236   0.01430902  0.01931863 ... -0.00034913 -0.00871589
   0.05858414]]
8   [0.35588953]
------------>[[ 0.00327164 -0.00486788  0.01729708 ...  0.00672986 -0.00926583
   0.00033302]
 [ 0.01502572 -0.02288492  0.04027691 ... -0.01237136  0.00297063
  -0.02746335]
 [-0.0208819   0.00787599  0.0250624  ...  0.02144732 -0.00817642
  -0.00834852]
 ...
 [ 0.01108283 -0.00381677  0.01079645 ... -0.01985481 -0.03211701
  -0.00654931]
 [-0.05511035  0.01761189 -0.00004322 ... -0.01521848  0.03135123
   0.00966418]
 [-0.00962118  0.01431117  0.01932063 ... -0.00034691 -0.00871373
   0.05858615]]
9   [0.34107792]
------------>[[ 0.00327321 -0.00486656  0.01729841 ...  0.00673112 -0.00926464
   0.0003342 ]
 [ 0.01502425 -0.0228861   0.04027558 ... -0.01237284  0.00296923
  -0.02746457]
 [-0.02088172  0.00787619  0.02506248 ...  0.02144785 -0.00817606
  -0.00834802]
 ...
 [ 0.01108071 -0.00381857  0.0107948  ... -0.0198565  -0.032119
  -0.00655123]
 [-0.05510743  0.01761463 -0.00004036 ... -0.0152154   0.03135398
   0.00966707]
 [-0.00961834  0.01431361  0.01932298 ... -0.00034457 -0.00871116
   0.0585887 ]]
10   [0.32676312]
------------>[[ 0.00327531 -0.00486489  0.01730035 ...  0.00673277 -0.00926291
   0.00033588]
 [ 0.01502235 -0.02288758  0.04027374 ... -0.01237476  0.00296749
  -0.02746632]
 [-0.02088134  0.00787634  0.02506259 ...  0.0214484  -0.00817582
  -0.00834744]
 ...
 [ 0.01107925 -0.00381956  0.01079369 ... -0.01985771 -0.03212016
  -0.00655236]
 [-0.05510498  0.01761692 -0.0000379  ... -0.01521275  0.03135633
   0.00966963]
 [-0.00961595  0.01431572  0.01932514 ... -0.00034242 -0.00870889
   0.058591  ]]
11   [0.2862789]
------------>[[ 0.00327625 -0.00486431  0.01730107 ...  0.00673332 -0.00926225
   0.00033659]
 [ 0.01501922 -0.02289024  0.0402707  ... -0.01237784  0.00296456
  -0.02746904]
 [-0.02087994  0.00787769  0.02506383 ...  0.02144988 -0.00817452
  -0.00834583]
 ...
 [ 0.01107861 -0.00381956  0.01079352 ... -0.01985813 -0.03212059
  -0.00655278]
 [-0.05510135  0.0176202  -0.0000344  ... -0.01520892  0.03135987
   0.00967319]
 [-0.00961422  0.01431711  0.01932658 ... -0.00034084 -0.00870741
   0.05859245]]
```


## after add gradient_merge
batch_size 32

steps 48

sh run_grad.sh

```
0   [0.31094944]
------------>[[ 0.0032556  -0.00488071  0.01728371 ...  0.00671671 -0.00927844
   0.00032147]
 [ 0.0150439  -0.02286995  0.0402944  ... -0.01235377  0.00298763
  -0.02744726]
 [-0.02089728  0.00786143  0.02504836 ...  0.02142998 -0.00819196
  -0.00836666]
 ...
 [ 0.01109565 -0.00380852  0.0108056  ... -0.01984465 -0.03210622
  -0.00653829]
 [-0.05513971  0.01758469 -0.00007176 ... -0.01524939  0.031323
   0.00963451]
 [-0.0096302   0.01430401  0.0193146  ... -0.00035359 -0.00872125
   0.05857885]]
1   [0.27595904]
------------>[[ 0.0032556  -0.00488071  0.01728371 ...  0.00671671 -0.00927844
   0.00032147]
 [ 0.0150439  -0.02286995  0.0402944  ... -0.01235377  0.00298763
  -0.02744726]
 [-0.02089728  0.00786143  0.02504836 ...  0.02142998 -0.00819196
  -0.00836666]
 ...
 [ 0.01109565 -0.00380852  0.0108056  ... -0.01984465 -0.03210622
  -0.00653829]
 [-0.05513971  0.01758469 -0.00007176 ... -0.01524939  0.031323
   0.00963451]
 [-0.0096302   0.01430401  0.0193146  ... -0.00035359 -0.00872125
   0.05857885]]
2   [0.3347813]
------------>[[ 0.0032556  -0.00488071  0.01728371 ...  0.00671671 -0.00927844
   0.00032147]
 [ 0.0150439  -0.02286995  0.0402944  ... -0.01235377  0.00298763
  -0.02744726]
 [-0.02089728  0.00786143  0.02504836 ...  0.02142998 -0.00819196
  -0.00836666]
 ...
 [ 0.01109565 -0.00380852  0.0108056  ... -0.01984465 -0.03210622
  -0.00653829]
 [-0.05513971  0.01758469 -0.00007176 ... -0.01524939  0.031323
   0.00963451]
 [-0.0096302   0.01430401  0.0193146  ... -0.00035359 -0.00872125
   0.05857885]]
avgloss -------->[0.29568613]
3   [0.2610547]
------------>[[ 0.00325679 -0.00487973  0.01728465 ...  0.00671757 -0.00927767
   0.00032223]
 [ 0.01504303 -0.02287037  0.04029361 ... -0.01235466  0.00298695
  -0.02744791]
 [-0.02089648  0.0078622   0.02504907 ...  0.02143094 -0.0081911
  -0.0083656 ]
 ...
 [ 0.01109418 -0.00380935  0.01080439 ... -0.0198461  -0.03210769
  -0.00653965]
 [-0.05513816  0.01758596 -0.0000703  ... -0.01524768  0.0313245
   0.00963614]
 [-0.00963047  0.01430357  0.01931395 ... -0.00035427 -0.00872168
   0.05857831]]
4   [0.3722331]
------------>[[ 0.00325679 -0.00487973  0.01728465 ...  0.00671757 -0.00927767
   0.00032223]
 [ 0.01504303 -0.02287037  0.04029361 ... -0.01235466  0.00298695
  -0.02744791]
 [-0.02089648  0.0078622   0.02504907 ...  0.02143094 -0.0081911
  -0.0083656 ]
 ...
 [ 0.01109418 -0.00380935  0.01080439 ... -0.0198461  -0.03210769
  -0.00653965]
 [-0.05513816  0.01758596 -0.0000703  ... -0.01524768  0.0313245
   0.00963614]
 [-0.00963047  0.01430357  0.01931395 ... -0.00035427 -0.00872168
   0.05857831]]
5   [0.3306498]
------------>[[ 0.00325679 -0.00487973  0.01728465 ...  0.00671757 -0.00927767
   0.00032223]
 [ 0.01504303 -0.02287037  0.04029361 ... -0.01235466  0.00298695
  -0.02744791]
 [-0.02089648  0.0078622   0.02504907 ...  0.02143094 -0.0081911
  -0.0083656 ]
 ...
 [ 0.01109418 -0.00380935  0.01080439 ... -0.0198461  -0.03210769
  -0.00653965]
 [-0.05513816  0.01758596 -0.0000703  ... -0.01524768  0.0313245
   0.00963614]
 [-0.00963047  0.01430357  0.01931395 ... -0.00035427 -0.00872168
   0.05857831]]
6   [0.37050053]
------------>[[ 0.00325679 -0.00487973  0.01728465 ...  0.00671757 -0.00927767
   0.00032223]
 [ 0.01504303 -0.02287037  0.04029361 ... -0.01235466  0.00298695
  -0.02744791]
 [-0.02089648  0.0078622   0.02504907 ...  0.02143094 -0.0081911
  -0.0083656 ]
 ...
 [ 0.01109418 -0.00380935  0.01080439 ... -0.0198461  -0.03210769
  -0.00653965]
 [-0.05513816  0.01758596 -0.0000703  ... -0.01524768  0.0313245
   0.00963614]
 [-0.00963047  0.01430357  0.01931395 ... -0.00035427 -0.00872168
   0.05857831]]
avgloss -------->[0.36115646]
7   [0.37124234]
------------>[[ 0.00325783 -0.00487893  0.01728542 ...  0.00671828 -0.00927696
   0.00032267]
 [ 0.01503996 -0.02287298  0.04029076 ... -0.01235752  0.00298396
  -0.0274507 ]
 [-0.02089628  0.00786247  0.0250492  ...  0.02143151 -0.00819083
  -0.0083651 ]
 ...
 [ 0.01109258 -0.00381054  0.01080323 ... -0.01984735 -0.03210912
  -0.00654107]
 [-0.05513571  0.01758823 -0.00006782 ... -0.01524513  0.03132679
   0.00963861]
 [-0.0096294   0.01430442  0.0193147  ... -0.00035345 -0.00872087
   0.05857904]]
8   [0.35977998]
------------>[[ 0.00325783 -0.00487893  0.01728542 ...  0.00671828 -0.00927696
   0.00032267]
 [ 0.01503996 -0.02287298  0.04029076 ... -0.01235752  0.00298396
  -0.0274507 ]
 [-0.02089628  0.00786247  0.0250492  ...  0.02143151 -0.00819083
  -0.0083651 ]
 ...
 [ 0.01109258 -0.00381054  0.01080323 ... -0.01984735 -0.03210912
  -0.00654107]
 [-0.05513571  0.01758823 -0.00006782 ... -0.01524513  0.03132679
   0.00963861]
 [-0.0096294   0.01430442  0.0193147  ... -0.00035345 -0.00872087
   0.05857904]]
9   [0.3390993]
------------>[[ 0.00325783 -0.00487893  0.01728542 ...  0.00671828 -0.00927696
   0.00032267]
 [ 0.01503996 -0.02287298  0.04029076 ... -0.01235752  0.00298396
  -0.0274507 ]
 [-0.02089628  0.00786247  0.0250492  ...  0.02143151 -0.00819083
  -0.0083651 ]
 ...
 [ 0.01109258 -0.00381054  0.01080323 ... -0.01984735 -0.03210912
  -0.00654107]
 [-0.05513571  0.01758823 -0.00006782 ... -0.01524513  0.03132679
   0.00963861]
 [-0.0096294   0.01430442  0.0193147  ... -0.00035345 -0.00872087
   0.05857904]]
10   [0.34845543]
------------>[[ 0.00325783 -0.00487893  0.01728542 ...  0.00671828 -0.00927696
   0.00032267]
 [ 0.01503996 -0.02287298  0.04029076 ... -0.01235752  0.00298396
  -0.0274507 ]
 [-0.02089628  0.00786247  0.0250492  ...  0.02143151 -0.00819083
  -0.0083651 ]
 ...
 [ 0.01109258 -0.00381054  0.01080323 ... -0.01984735 -0.03210912
  -0.00654107]
 [-0.05513571  0.01758823 -0.00006782 ... -0.01524513  0.03132679
   0.00963861]
 [-0.0096294   0.01430442  0.0193147  ... -0.00035345 -0.00872087
   0.05857904]]
avgloss -------->[0.3366242]
11   [0.29916218]
------------>[[ 0.00326039 -0.00487684  0.01728758 ...  0.00672072 -0.00927485
   0.00032486]
 [ 0.01503776 -0.02287492  0.04028855 ... -0.01235968  0.00298198
  -0.02745253]
 [-0.02089414  0.00786436  0.02505121 ...  0.02143367 -0.0081888
  -0.00836281]
 ...
 [ 0.01109286 -0.00380986  0.01080392 ... -0.01984675 -0.03210872
  -0.00654065]
 [-0.05513266  0.01759095 -0.00006477 ... -0.01524187  0.03132967
   0.00964181]
 [-0.00962864  0.01430498  0.01931518 ... -0.00035297 -0.00872017
   0.05857989]]
12   [0.27962992]
------------>[[ 0.00326039 -0.00487684  0.01728758 ...  0.00672072 -0.00927485
   0.00032486]
 [ 0.01503776 -0.02287492  0.04028855 ... -0.01235968  0.00298198
  -0.02745253]
 [-0.02089414  0.00786436  0.02505121 ...  0.02143367 -0.0081888
  -0.00836281]
 ...
 [ 0.01109286 -0.00380986  0.01080392 ... -0.01984675 -0.03210872
  -0.00654065]
 [-0.05513266  0.01759095 -0.00006477 ... -0.01524187  0.03132967
   0.00964181]
 [-0.00962864  0.01430498  0.01931518 ... -0.00035297 -0.00872017
   0.05857989]]
13   [0.32714328]
------------>[[ 0.00326039 -0.00487684  0.01728758 ...  0.00672072 -0.00927485
   0.00032486]
 [ 0.01503776 -0.02287492  0.04028855 ... -0.01235968  0.00298198
  -0.02745253]
 [-0.02089414  0.00786436  0.02505121 ...  0.02143367 -0.0081888
  -0.00836281]
 ...
 [ 0.01109286 -0.00380986  0.01080392 ... -0.01984675 -0.03210872
  -0.00654065]
 [-0.05513266  0.01759095 -0.00006477 ... -0.01524187  0.03132967
   0.00964181]
 [-0.00962864  0.01430498  0.01931518 ... -0.00035297 -0.00872017
   0.05857989]]
14   [0.24377973]
------------>[[ 0.00326039 -0.00487684  0.01728758 ...  0.00672072 -0.00927485
   0.00032486]
 [ 0.01503776 -0.02287492  0.04028855 ... -0.01235968  0.00298198
  -0.02745253]
 [-0.02089414  0.00786436  0.02505121 ...  0.02143367 -0.0081888
  -0.00836281]
 ...
 [ 0.01109286 -0.00380986  0.01080392 ... -0.01984675 -0.03210872
  -0.00654065]
 [-0.05513266  0.01759095 -0.00006477 ... -0.01524187  0.03132967
   0.00964181]
 [-0.00962864  0.01430498  0.01931518 ... -0.00035297 -0.00872017
   0.05857989]]
avgloss -------->[0.30737254]
15   [0.37893724]
------------>[[ 0.00326109 -0.00487633  0.01728828 ...  0.00672141 -0.00927429
   0.00032537]
 [ 0.01503677 -0.02287557  0.04028765 ... -0.01236058  0.00298096
  -0.02745331]
 [-0.02089231  0.00786604  0.02505258 ...  0.0214355  -0.00818702
  -0.00836079]
 ...
 [ 0.01109193 -0.00381047  0.01080328 ... -0.01984772 -0.0321096
  -0.00654166]
 [-0.0551292   0.01759418 -0.0000615  ... -0.01523818  0.031333
   0.00964531]
 [-0.00962826  0.01430529  0.0193154  ... -0.00035272 -0.00871991
   0.05858026]]
16   [0.24941385]
------------>[[ 0.00326109 -0.00487633  0.01728828 ...  0.00672141 -0.00927429
   0.00032537]
 [ 0.01503677 -0.02287557  0.04028765 ... -0.01236058  0.00298096
  -0.02745331]
 [-0.02089231  0.00786604  0.02505258 ...  0.0214355  -0.00818702
  -0.00836079]
 ...
 [ 0.01109193 -0.00381047  0.01080328 ... -0.01984772 -0.0321096
  -0.00654166]
 [-0.0551292   0.01759418 -0.0000615  ... -0.01523818  0.031333
   0.00964531]
 [-0.00962826  0.01430529  0.0193154  ... -0.00035272 -0.00871991
   0.05858026]]
17   [0.38646042]
------------>[[ 0.00326109 -0.00487633  0.01728828 ...  0.00672141 -0.00927429
   0.00032537]
 [ 0.01503677 -0.02287557  0.04028765 ... -0.01236058  0.00298096
  -0.02745331]
 [-0.02089231  0.00786604  0.02505258 ...  0.0214355  -0.00818702
  -0.00836079]
 ...
 [ 0.01109193 -0.00381047  0.01080328 ... -0.01984772 -0.0321096
  -0.00654166]
 [-0.0551292   0.01759418 -0.0000615  ... -0.01523818  0.031333
   0.00964531]
 [-0.00962826  0.01430529  0.0193154  ... -0.00035272 -0.00871991
   0.05858026]]
18   [0.3619661]
------------>[[ 0.00326109 -0.00487633  0.01728828 ...  0.00672141 -0.00927429
   0.00032537]
 [ 0.01503677 -0.02287557  0.04028765 ... -0.01236058  0.00298096
  -0.02745331]
 [-0.02089231  0.00786604  0.02505258 ...  0.0214355  -0.00818702
  -0.00836079]
 ...
 [ 0.01109193 -0.00381047  0.01080328 ... -0.01984772 -0.0321096
  -0.00654166]
 [-0.0551292   0.01759418 -0.0000615  ... -0.01523818  0.031333
   0.00964531]
 [-0.00962826  0.01430529  0.0193154  ... -0.00035272 -0.00871991
   0.05858026]]
avgloss -------->[0.34085673]
19   [0.3655865]
------------>[[ 0.00326397 -0.0048739   0.01729077 ...  0.00672391 -0.00927189
   0.00032767]
 [ 0.01503458 -0.02287736  0.04028547 ... -0.01236274  0.00297887
  -0.02745526]
 [-0.02089187  0.00786638  0.02505288 ...  0.02143609 -0.00818656
  -0.00836013]
 ...
 [ 0.01109042 -0.00381133  0.01080217 ... -0.01984893 -0.03211083
  -0.00654307]
 [-0.05512483  0.01759816 -0.00005747 ... -0.01523391  0.03133708
   0.0096495 ]
 [-0.00962767  0.01430586  0.01931574 ... -0.00035235 -0.00871944
   0.05858071]]
20   [0.32746112]
------------>[[ 0.00326397 -0.0048739   0.01729077 ...  0.00672391 -0.00927189
   0.00032767]
 [ 0.01503458 -0.02287736  0.04028547 ... -0.01236274  0.00297887
  -0.02745526]
 [-0.02089187  0.00786638  0.02505288 ...  0.02143609 -0.00818656
  -0.00836013]
 ...
 [ 0.01109042 -0.00381133  0.01080217 ... -0.01984893 -0.03211083
  -0.00654307]
 [-0.05512483  0.01759816 -0.00005747 ... -0.01523391  0.03133708
   0.0096495 ]
 [-0.00962767  0.01430586  0.01931574 ... -0.00035235 -0.00871944
   0.05858071]]
21   [0.40815654]
------------>[[ 0.00326397 -0.0048739   0.01729077 ...  0.00672391 -0.00927189
   0.00032767]
 [ 0.01503458 -0.02287736  0.04028547 ... -0.01236274  0.00297887
  -0.02745526]
 [-0.02089187  0.00786638  0.02505288 ...  0.02143609 -0.00818656
  -0.00836013]
 ...
 [ 0.01109042 -0.00381133  0.01080217 ... -0.01984893 -0.03211083
  -0.00654307]
 [-0.05512483  0.01759816 -0.00005747 ... -0.01523391  0.03133708
   0.0096495 ]
 [-0.00962767  0.01430586  0.01931574 ... -0.00035235 -0.00871944
   0.05858071]]
22   [0.41809157]
------------>[[ 0.00326397 -0.0048739   0.01729077 ...  0.00672391 -0.00927189
   0.00032767]
 [ 0.01503458 -0.02287736  0.04028547 ... -0.01236274  0.00297887
  -0.02745526]
 [-0.02089187  0.00786638  0.02505288 ...  0.02143609 -0.00818656
  -0.00836013]
 ...
 [ 0.01109042 -0.00381133  0.01080217 ... -0.01984893 -0.03211083
  -0.00654307]
 [-0.05512483  0.01759816 -0.00005747 ... -0.01523391  0.03133708
   0.0096495 ]
 [-0.00962767  0.01430586  0.01931574 ... -0.00035235 -0.00871944
   0.05858071]]
avgloss -------->[0.37358743]
23   [0.34064057]
------------>[[ 0.00326639 -0.00487175  0.01729292 ...  0.00672599 -0.00926979
   0.00032957]
 [ 0.01503262 -0.02287916  0.04028361 ... -0.01236481  0.00297709
  -0.02745693]
 [-0.02088915  0.00786918  0.02505555 ...  0.0214393  -0.00818381
  -0.00835684]
 ...
 [ 0.01108954 -0.0038119   0.01080148 ... -0.01984955 -0.03211144
  -0.00654371]
 [-0.05512026  0.01760272 -0.00005291 ... -0.01522891  0.03134158
   0.00965404]
 [-0.00962573  0.01430745  0.01931728 ... -0.0003507  -0.00871765
   0.05858242]]
24   [0.2951051]
------------>[[ 0.00326639 -0.00487175  0.01729292 ...  0.00672599 -0.00926979
   0.00032957]
 [ 0.01503262 -0.02287916  0.04028361 ... -0.01236481  0.00297709
  -0.02745693]
 [-0.02088915  0.00786918  0.02505555 ...  0.0214393  -0.00818381
  -0.00835684]
 ...
 [ 0.01108954 -0.0038119   0.01080148 ... -0.01984955 -0.03211144
  -0.00654371]
 [-0.05512026  0.01760272 -0.00005291 ... -0.01522891  0.03134158
   0.00965404]
 [-0.00962573  0.01430745  0.01931728 ... -0.0003507  -0.00871765
   0.05858242]]
25   [0.33621362]
------------>[[ 0.00326639 -0.00487175  0.01729292 ...  0.00672599 -0.00926979
   0.00032957]
 [ 0.01503262 -0.02287916  0.04028361 ... -0.01236481  0.00297709
  -0.02745693]
 [-0.02088915  0.00786918  0.02505555 ...  0.0214393  -0.00818381
  -0.00835684]
 ...
 [ 0.01108954 -0.0038119   0.01080148 ... -0.01984955 -0.03211144
  -0.00654371]
 [-0.05512026  0.01760272 -0.00005291 ... -0.01522891  0.03134158
   0.00965404]
 [-0.00962573  0.01430745  0.01931728 ... -0.0003507  -0.00871765
   0.05858242]]
26   [0.39102983]
------------>[[ 0.00326639 -0.00487175  0.01729292 ...  0.00672599 -0.00926979
   0.00032957]
 [ 0.01503262 -0.02287916  0.04028361 ... -0.01236481  0.00297709
  -0.02745693]
 [-0.02088915  0.00786918  0.02505555 ...  0.0214393  -0.00818381
  -0.00835684]
 ...
 [ 0.01108954 -0.0038119   0.01080148 ... -0.01984955 -0.03211144
  -0.00654371]
 [-0.05512026  0.01760272 -0.00005291 ... -0.01522891  0.03134158
   0.00965404]
 [-0.00962573  0.01430745  0.01931728 ... -0.0003507  -0.00871765
   0.05858242]]
avgloss -------->[0.33240762]
27   [0.307282]
------------>[[ 0.00326861 -0.00486996  0.01729468 ...  0.00672766 -0.00926806
   0.00033101]
 [ 0.01503042 -0.02288103  0.04028141 ... -0.01236691  0.00297496
  -0.02745906]
 [-0.02088803  0.00787029  0.02505665 ...  0.02144069 -0.00818253
  -0.00835523]
 ...
 [ 0.01108734 -0.00381362  0.01079982 ... -0.01985138 -0.0321133
  -0.0065456 ]
 [-0.05511615  0.01760673 -0.00004862 ... -0.01522456  0.03134567
   0.00965827]
 [-0.00962398  0.01430881  0.01931856 ... -0.00034933 -0.00871615
   0.05858382]]
28   [0.27525866]
------------>[[ 0.00326861 -0.00486996  0.01729468 ...  0.00672766 -0.00926806
   0.00033101]
 [ 0.01503042 -0.02288103  0.04028141 ... -0.01236691  0.00297496
  -0.02745906]
 [-0.02088803  0.00787029  0.02505665 ...  0.02144069 -0.00818253
  -0.00835523]
 ...
 [ 0.01108734 -0.00381362  0.01079982 ... -0.01985138 -0.0321133
  -0.0065456 ]
 [-0.05511615  0.01760673 -0.00004862 ... -0.01522456  0.03134567
   0.00965827]
 [-0.00962398  0.01430881  0.01931856 ... -0.00034933 -0.00871615
   0.05858382]]
29   [0.2902481]
------------>[[ 0.00326861 -0.00486996  0.01729468 ...  0.00672766 -0.00926806
   0.00033101]
 [ 0.01503042 -0.02288103  0.04028141 ... -0.01236691  0.00297496
  -0.02745906]
 [-0.02088803  0.00787029  0.02505665 ...  0.02144069 -0.00818253
  -0.00835523]
 ...
 [ 0.01108734 -0.00381362  0.01079982 ... -0.01985138 -0.0321133
  -0.0065456 ]
 [-0.05511615  0.01760673 -0.00004862 ... -0.01522456  0.03134567
   0.00965827]
 [-0.00962398  0.01430881  0.01931856 ... -0.00034933 -0.00871615
   0.05858382]]
30   [0.19939119]
------------>[[ 0.00326861 -0.00486996  0.01729468 ...  0.00672766 -0.00926806
   0.00033101]
 [ 0.01503042 -0.02288103  0.04028141 ... -0.01236691  0.00297496
  -0.02745906]
 [-0.02088803  0.00787029  0.02505665 ...  0.02144069 -0.00818253
  -0.00835523]
 ...
 [ 0.01108734 -0.00381362  0.01079982 ... -0.01985138 -0.0321133
  -0.0065456 ]
 [-0.05511615  0.01760673 -0.00004862 ... -0.01522456  0.03134567
   0.00965827]
 [-0.00962398  0.01430881  0.01931856 ... -0.00034933 -0.00871615
   0.05858382]]
avgloss -------->[0.2895818]
31   [0.39342928]
------------>[[ 0.00327092 -0.00486813  0.01729666 ...  0.00672956 -0.00926611
   0.00033294]
 [ 0.01502885 -0.02288222  0.04027987 ... -0.01236843  0.00297352
  -0.02746046]
 [-0.0208852   0.00787294  0.02505932 ...  0.0214438  -0.00817975
  -0.00835223]
 ...
 [ 0.01108522 -0.00381511  0.01079822 ... -0.019853   -0.03211506
  -0.00654736]
 [-0.0551131   0.0176094  -0.00004582 ... -0.01522143  0.03134868
   0.00966137]
 [-0.0096236   0.01430902  0.01931863 ... -0.00034913 -0.00871589
   0.05858414]]
32   [0.3539441]
------------>[[ 0.00327092 -0.00486813  0.01729666 ...  0.00672956 -0.00926611
   0.00033294]
 [ 0.01502885 -0.02288222  0.04027987 ... -0.01236843  0.00297352
  -0.02746046]
 [-0.0208852   0.00787294  0.02505932 ...  0.0214438  -0.00817975
  -0.00835223]
 ...
 [ 0.01108522 -0.00381511  0.01079822 ... -0.019853   -0.03211506
  -0.00654736]
 [-0.0551131   0.0176094  -0.00004582 ... -0.01522143  0.03134868
   0.00966137]
 [-0.0096236   0.01430902  0.01931863 ... -0.00034913 -0.00871589
   0.05858414]]
33   [0.34331846]
------------>[[ 0.00327092 -0.00486813  0.01729666 ...  0.00672956 -0.00926611
   0.00033294]
 [ 0.01502885 -0.02288222  0.04027987 ... -0.01236843  0.00297352
  -0.02746046]
 [-0.0208852   0.00787294  0.02505932 ...  0.0214438  -0.00817975
  -0.00835223]
 ...
 [ 0.01108522 -0.00381511  0.01079822 ... -0.019853   -0.03211506
  -0.00654736]
 [-0.0551131   0.0176094  -0.00004582 ... -0.01522143  0.03134868
   0.00966137]
 [-0.0096236   0.01430902  0.01931863 ... -0.00034913 -0.00871589
   0.05858414]]
34   [0.36636448]
------------>[[ 0.00327092 -0.00486813  0.01729666 ...  0.00672956 -0.00926611
   0.00033294]
 [ 0.01502885 -0.02288222  0.04027987 ... -0.01236843  0.00297352
  -0.02746046]
 [-0.0208852   0.00787294  0.02505932 ...  0.0214438  -0.00817975
  -0.00835223]
 ...
 [ 0.01108522 -0.00381511  0.01079822 ... -0.019853   -0.03211506
  -0.00654736]
 [-0.0551131   0.0176094  -0.00004582 ... -0.01522143  0.03134868
   0.00966137]
 [-0.0096236   0.01430902  0.01931863 ... -0.00034913 -0.00871589
   0.05858414]]
avgloss -------->[0.35588953]
35   [0.3599311]
------------>[[ 0.00327164 -0.00486788  0.01729708 ...  0.00672986 -0.00926583
   0.00033302]
 [ 0.01502572 -0.02288492  0.04027691 ... -0.01237136  0.00297063
  -0.02746335]
 [-0.0208819   0.00787599  0.0250624  ...  0.02144732 -0.00817642
  -0.00834852]
 ...
 [ 0.01108283 -0.00381677  0.01079645 ... -0.01985481 -0.03211701
  -0.00654931]
 [-0.05511035  0.01761189 -0.00004322 ... -0.01521848  0.03135123
   0.00966418]
 [-0.00962118  0.01431117  0.01932063 ... -0.00034691 -0.00871373
   0.05858615]]
36   [0.3147862]
------------>[[ 0.00327164 -0.00486788  0.01729708 ...  0.00672986 -0.00926583
   0.00033302]
 [ 0.01502572 -0.02288492  0.04027691 ... -0.01237136  0.00297063
  -0.02746335]
 [-0.0208819   0.00787599  0.0250624  ...  0.02144732 -0.00817642
  -0.00834852]
 ...
 [ 0.01108283 -0.00381677  0.01079645 ... -0.01985481 -0.03211701
  -0.00654931]
 [-0.05511035  0.01761189 -0.00004322 ... -0.01521848  0.03135123
   0.00966418]
 [-0.00962118  0.01431117  0.01932063 ... -0.00034691 -0.00871373
   0.05858615]]
37   [0.44505563]
------------>[[ 0.00327164 -0.00486788  0.01729708 ...  0.00672986 -0.00926583
   0.00033302]
 [ 0.01502572 -0.02288492  0.04027691 ... -0.01237136  0.00297063
  -0.02746335]
 [-0.0208819   0.00787599  0.0250624  ...  0.02144732 -0.00817642
  -0.00834852]
 ...
 [ 0.01108283 -0.00381677  0.01079645 ... -0.01985481 -0.03211701
  -0.00654931]
 [-0.05511035  0.01761189 -0.00004322 ... -0.01521848  0.03135123
   0.00966418]
 [-0.00962118  0.01431117  0.01932063 ... -0.00034691 -0.00871373
   0.05858615]]
38   [0.3278364]
------------>[[ 0.00327164 -0.00486788  0.01729708 ...  0.00672986 -0.00926583
   0.00033302]
 [ 0.01502572 -0.02288492  0.04027691 ... -0.01237136  0.00297063
  -0.02746335]
 [-0.0208819   0.00787599  0.0250624  ...  0.02144732 -0.00817642
  -0.00834852]
 ...
 [ 0.01108283 -0.00381677  0.01079645 ... -0.01985481 -0.03211701
  -0.00654931]
 [-0.05511035  0.01761189 -0.00004322 ... -0.01521848  0.03135123
   0.00966418]
 [-0.00962118  0.01431117  0.01932063 ... -0.00034691 -0.00871373
   0.05858615]]
avgloss -------->[0.34107792]
39   [0.27663356]
------------>[[ 0.00327321 -0.00486656  0.01729841 ...  0.00673112 -0.00926464
   0.0003342 ]
 [ 0.01502425 -0.0228861   0.04027558 ... -0.01237284  0.00296923
  -0.02746457]
 [-0.02088172  0.00787619  0.02506248 ...  0.02144785 -0.00817606
  -0.00834802]
 ...
 [ 0.01108071 -0.00381857  0.0107948  ... -0.0198565  -0.032119
  -0.00655123]
 [-0.05510743  0.01761463 -0.00004036 ... -0.0152154   0.03135398
   0.00966707]
 [-0.00961834  0.01431361  0.01932298 ... -0.00034457 -0.00871116
   0.0585887 ]]
40   [0.37133047]
------------>[[ 0.00327321 -0.00486656  0.01729841 ...  0.00673112 -0.00926464
   0.0003342 ]
 [ 0.01502425 -0.0228861   0.04027558 ... -0.01237284  0.00296923
  -0.02746457]
 [-0.02088172  0.00787619  0.02506248 ...  0.02144785 -0.00817606
  -0.00834802]
 ...
 [ 0.01108071 -0.00381857  0.0107948  ... -0.0198565  -0.032119
  -0.00655123]
 [-0.05510743  0.01761463 -0.00004036 ... -0.0152154   0.03135398
   0.00966707]
 [-0.00961834  0.01431361  0.01932298 ... -0.00034457 -0.00871116
   0.0585887 ]]
41   [0.33982998]
------------>[[ 0.00327321 -0.00486656  0.01729841 ...  0.00673112 -0.00926464
   0.0003342 ]
 [ 0.01502425 -0.0228861   0.04027558 ... -0.01237284  0.00296923
  -0.02746457]
 [-0.02088172  0.00787619  0.02506248 ...  0.02144785 -0.00817606
  -0.00834802]
 ...
 [ 0.01108071 -0.00381857  0.0107948  ... -0.0198565  -0.032119
  -0.00655123]
 [-0.05510743  0.01761463 -0.00004036 ... -0.0152154   0.03135398
   0.00966707]
 [-0.00961834  0.01431361  0.01932298 ... -0.00034457 -0.00871116
   0.0585887 ]]
42   [0.29770842]
------------>[[ 0.00327321 -0.00486656  0.01729841 ...  0.00673112 -0.00926464
   0.0003342 ]
 [ 0.01502425 -0.0228861   0.04027558 ... -0.01237284  0.00296923
  -0.02746457]
 [-0.02088172  0.00787619  0.02506248 ...  0.02144785 -0.00817606
  -0.00834802]
 ...
 [ 0.01108071 -0.00381857  0.0107948  ... -0.0198565  -0.032119
  -0.00655123]
 [-0.05510743  0.01761463 -0.00004036 ... -0.0152154   0.03135398
   0.00966707]
 [-0.00961834  0.01431361  0.01932298 ... -0.00034457 -0.00871116
   0.0585887 ]]
avgloss -------->[0.32676312]
43   [0.29818365]
------------>[[ 0.00327531 -0.00486489  0.01730035 ...  0.00673277 -0.00926291
   0.00033588]
 [ 0.01502235 -0.02288758  0.04027374 ... -0.01237476  0.00296749
  -0.02746632]
 [-0.02088134  0.00787634  0.02506259 ...  0.0214484  -0.00817582
  -0.00834744]
 ...
 [ 0.01107925 -0.00381956  0.01079369 ... -0.01985771 -0.03212016
  -0.00655236]
 [-0.05510498  0.01761692 -0.0000379  ... -0.01521275  0.03135633
   0.00966963]
 [-0.00961595  0.01431572  0.01932514 ... -0.00034242 -0.00870889
   0.058591  ]]
44   [0.30554593]
------------>[[ 0.00327531 -0.00486489  0.01730035 ...  0.00673277 -0.00926291
   0.00033588]
 [ 0.01502235 -0.02288758  0.04027374 ... -0.01237476  0.00296749
  -0.02746632]
 [-0.02088134  0.00787634  0.02506259 ...  0.0214484  -0.00817582
  -0.00834744]
 ...
 [ 0.01107925 -0.00381956  0.01079369 ... -0.01985771 -0.03212016
  -0.00655236]
 [-0.05510498  0.01761692 -0.0000379  ... -0.01521275  0.03135633
   0.00966963]
 [-0.00961595  0.01431572  0.01932514 ... -0.00034242 -0.00870889
   0.058591  ]]
45   [0.29061708]
------------>[[ 0.00327531 -0.00486489  0.01730035 ...  0.00673277 -0.00926291
   0.00033588]
 [ 0.01502235 -0.02288758  0.04027374 ... -0.01237476  0.00296749
  -0.02746632]
 [-0.02088134  0.00787634  0.02506259 ...  0.0214484  -0.00817582
  -0.00834744]
 ...
 [ 0.01107925 -0.00381956  0.01079369 ... -0.01985771 -0.03212016
  -0.00655236]
 [-0.05510498  0.01761692 -0.0000379  ... -0.01521275  0.03135633
   0.00966963]
 [-0.00961595  0.01431572  0.01932514 ... -0.00034242 -0.00870889
   0.058591  ]]
46   [0.25203145]
------------>[[ 0.00327531 -0.00486489  0.01730035 ...  0.00673277 -0.00926291
   0.00033588]
 [ 0.01502235 -0.02288758  0.04027374 ... -0.01237476  0.00296749
  -0.02746632]
 [-0.02088134  0.00787634  0.02506259 ...  0.0214484  -0.00817582
  -0.00834744]
 ...
 [ 0.01107925 -0.00381956  0.01079369 ... -0.01985771 -0.03212016
  -0.00655236]
 [-0.05510498  0.01761692 -0.0000379  ... -0.01521275  0.03135633
   0.00966963]
 [-0.00961595  0.01431572  0.01932514 ... -0.00034242 -0.00870889
   0.058591  ]]
avgloss -------->[0.2862789]
47   [0.29692107]
------------>[[ 0.00327625 -0.00486431  0.01730107 ...  0.00673332 -0.00926225
   0.00033659]
 [ 0.01501922 -0.02289024  0.0402707  ... -0.01237784  0.00296456
  -0.02746904]
 [-0.02087994  0.00787769  0.02506383 ...  0.02144988 -0.00817452
  -0.00834583]
 ...
 [ 0.01107861 -0.00381956  0.01079352 ... -0.01985813 -0.03212059
  -0.00655278]
 [-0.05510135  0.0176202  -0.0000344  ... -0.01520892  0.03135987
   0.00967319]
 [-0.00961422  0.01431711  0.01932658 ... -0.00034084 -0.00870741
   0.05859245]]
```


loss的精度对齐，需要按k_steps对其求平均

例如：
```
if step % 4 == 3:
    avg_loss += res[0]
    print(f"avgloss -------->{avg_loss/4}")
    avg_loss = 0
else:
    avg_loss += res[0]
```    
    
# 结论
添加gradient_merge后的avgloss和添加之前的loss精度是对齐的

注：多卡时，需要将每个卡的loss相加后对齐精度
